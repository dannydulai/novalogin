version: '3.8'

services:
  # NovaAuth Application (Frontend + Backend + Nginx)
  novaauth:
    build:
      context: ..
      dockerfile: build/Dockerfile
      args:
        # Frontend build-time environment variables
        APP_NAME:           "NovaAuth"
        APP_PRIMARY_COLOR:  "#00CC99"
        HIDE_POWERED_BY:    "false"
        HIDE_REFERRAL_CODE: "false"
    environment:
      # Database connection (point to external postgres)
      DB_USER: "postgres"
      DB_PASSWORD: "postgres"
      DB_HOST: "docker.for.mac.localhost"
      DB_PORT: "5432"
      DB_NAME: "novaauth"
      
      # Required application settings
      ADMIN_APP_ID:       "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
      ADMIN_APP_SECRET:   "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
      ACCOUNT_APP_ID:     "bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb"
      ACCOUNT_APP_SECRET: "bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb"
      
      # Cookie settings
      COOKIE_DOMAIN:  "localhost"
      SESSION_SECRET: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
      
      # Host settings
      HOST: "localhost"
      
      # Login settings
      LOGIN_COOKIE_VERSION: "1"
      
      # Environment
      NODE_ENV: "production"
    ports:
      - "8080:80"
    restart: unless-stopped
